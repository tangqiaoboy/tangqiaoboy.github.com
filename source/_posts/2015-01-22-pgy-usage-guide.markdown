---
layout: post
title: "使用蒲公英来做iOS测试应用的分发"
date: 2015-01-22 19:16:06 +0800
comments: true
categories: iOS
---

{% img /images/pgy_0.jpg %}

## 前言

我在 [《给 iOS 工程增加 Daily Build》](http://blog.devtang.com/blog/2012/02/16/apply-daily-build-in-ios-project/) 一文中介绍过如何用命令行生成 IPA 文件以及通过 `itms-services` 协议 来让用户可以直接在网页上安装测试应用。但是这种方法虽然有效，但是还是比较麻烦，因为：

 1. 开发者需要自己写相关的 Build 脚本。
 1. 开发者需要自己搭建好应用下载的服务器。
 1. 如果要做得更友好，开发者还需要部署 CDN 服务、增加扫描二维码下载等功能。

所以本文给大家推荐一个叫 “[蒲公英](http://www.pgyer.com/)” 的免费服务，帮助开发者能够方便地来做 iOS 应用的测试分发工作。蒲公英于 2014 年 7 月正式上线，我自己使用过一段时间，还是挺满意的。

下面我们就来看看，如何使用 “[蒲公英](http://www.pgyer.com/)” 来进行测试版本应用的分发工作。

## 生成 IPA 文件

生成应用的 IPA 文件可以使用命令行 `xcodebuild exportArchive -exportFormat ipa`来完成，也可以使用 Xcode 提供的相应功能。相信大部分同学应该都用过，我就简单介绍一下。

首先将编译的目标机器设置成 “iOS Device"，然后点击”Product"->"Archive"，Archive 成功之后，就可以在 Xcode 的 Organizer 中看到相应的文件。

接下来点击 Organizer 中的 "Export" 按钮，如下图所示：

{% img /images/export_ipa_1.jpg %}

在接下来的弹出界面中选择 “Save for Ad Hoc Deployment"。如下图所示：

{% img /images/export_ipa_2.jpg %}

选择完成后点 Next，Xcode 会自动将测试设备的签名信息附加上，并将相应的 IPA 文件导出。

## 上传到蒲公英

如果是第一次使用蒲公英，我们需要访问 [蒲公英的网址](http://www.pgyer.com/user/register) 进行注册。注册主要是为了保护测试应用的安全和设置相应的权限（例如设置下载密码）。

注册之后，点击[蒲公英网站首页](http://www.pgyer.com/)的 "发布应用"，然后选择之前生成的 IPA 文件即可完成上传 IPA 的过程。蒲公英对上传速度进行了很大程度的优化，上传应用速度非常快，下图是我测试上传猿题库的过程（上传 18M 的 IPA 文件大概花了半分钟时间，平均速度应该超过了 500K 每秒）：

{% img /images/pgy_1.jpg %}

上传成功后，蒲公英会自动分析应用的 Bundle ID 信息，将其在 App Store 上的应用介绍和截图获取下来。然后你可以选择设置一个 “安装密码”，以避免一些越狱用户非法安装你的应用。对于小范围试用的应用，建议也不要将其发布到 "应用广场"。如下所示：

{% img /images/pgy_2.jpg %}

设置好所有需要的信息后，点击发布应用，蒲公英会生成一个应用分发的网页。如下图所示：

{% img /images/pgy_3.jpg %}

你可以把这个网页发给你的测试用户:

 * 如果用户在手机上打开这个页面，则可以直接点击 “安装按钮” 来一键下载和安装测试应用。
 * 如果用户在电脑上打开这个应用，则可以用扫描二维码的方式来一键下载和安装测试应用。

## 一些小技巧

 * 有企业证书的同学，如果将 IPA 在本地用企业证书签名，则可以把蒲公英当作一个企业应用发布渠道，省去部署分发服务器的烦恼，但最好设置安装密码，以免被苹果认为滥用企业证书。
 * 嫌每次打开蒲公英的网页太麻烦？蒲公英提供了 [Mac 客户端](http://www.pgyer.com/apps)，所有上传和设置操作都可以在客户端上直接进行。

